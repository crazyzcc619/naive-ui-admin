var ut=Object.defineProperty,dt=Object.defineProperties;var mt=Object.getOwnPropertyDescriptors;var De=Object.getOwnPropertySymbols;var ft=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable;var xe=(e,t,n)=>t in e?ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,C=(e,t)=>{for(var n in t||(t={}))ft.call(t,n)&&xe(e,n,t[n]);if(De)for(var n of De(t))gt.call(t,n)&&xe(e,n,t[n]);return e},A=(e,t)=>dt(e,mt(t));var H=(e,t,n)=>new Promise((o,s)=>{var l=i=>{try{c(n.next(i))}catch(r){s(r)}},a=i=>{try{c(n.throw(i))}catch(r){s(r)}},c=i=>i.done?o(i.value):Promise.resolve(i.value).then(l,a);c((n=n.apply(e,t)).next())});import{bk as pt,bl as ht,V as T,bm as _t,d as ie,s as U,bn as me,S as bt,bo as Ct,bp as yt,bq as vt,e as I,i as Fe,j as E,br as fe,h as Le,q as le,A as X,u as d,o as N,a0 as ee,Y as _,a as x,X as h,Z as kt,bj as Y,_ as ae,am as Pe,ai as Ie,aw as St,ax as Ce,aF as wt,al as Et,aS as Re,bs as ye,a4 as $t,b2 as Ot,aU as Dt,aG as xt,aL as Ft,b7 as Lt,bt as Ae,bu as Pt,bv as It,bw as Ve,bx as Rt,by as At,bz as Vt,c as Z,w as ze,v as Te,t as ge,$ as te,bA as pe,bB as zt,f as Ne,aR as Be,bC as Tt,bD as Nt,bE as Bt,ab as he,bF as Ht,r as He,bG as Ut,bH as jt,F as Ue,p as Mt,b as qt,av as je,bI as Kt}from"./vendor.21d60ab8.js";import{S as Wt}from"./sortable.esm.81321d43.js";import{u as Gt}from"./useDesignSetting.9b7d21a8.js";import{_ as _e,i as Qt,a as ve,b as B,c as ke,d as re,e as ce,f as Me}from"./index.8d035c2e.js";import{p as Se}from"./propTypes.13e00d90.js";import{c as Xt}from"./componentSetting.df76d574.js";import{t as Yt,a as Zt,u as Jt}from"./index.esm.82824a3c.js";const qe=Symbol("s-table");function en(e){ht(qe,e)}function Ke(){return pt(qe)}function we(e){e.parentElement!==null&&e.parentElement.removeChild(e)}function We(e,t,n){const o=n===0?e.children[0]:e.children[n-1].nextSibling;e.insertBefore(t,o)}function tn(){return typeof window!="undefined"?window.console:global.console}const nn=tn();function on(e){const t=Object.create(null);return function(o){return t[o]||(t[o]=e(o))}}const sn=/-(\w)/g,ln=on(e=>e.replace(sn,(t,n)=>n.toUpperCase())),Ge=["Start","Add","Remove","Update","End"],Qe=["Choose","Unchoose","Sort","Filter","Clone"],Xe=["Move"],an=[Xe,Ge,Qe].flatMap(e=>e).map(e=>`on${e}`),Ee={manage:Xe,manageAndEmit:Ge,emit:Qe};function rn(e){return an.indexOf(e)!==-1}const cn=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function un(e){return cn.includes(e)}function dn(e){return["transition-group","TransitionGroup"].includes(e)}function Ye(e){return["id","class","role","style"].includes(e)||e.startsWith("data-")||e.startsWith("aria-")||e.startsWith("on")}function Ze(e){return e.reduce((t,[n,o])=>(t[n]=o,t),{})}function mn({$attrs:e,componentData:t={}}){const n=Ze(Object.entries(e).filter(([o,s])=>Ye(o)));return C(C({},n),t)}function fn({$attrs:e,callBackBuilder:t}){const n=Ze(Je(e));Object.entries(t).forEach(([s,l])=>{Ee[s].forEach(a=>{n[`on${a}`]=l(a)})});const o=`[data-draggable]${n.draggable||""}`;return A(C({},n),{draggable:o})}function Je(e){return Object.entries(e).filter(([t,n])=>!Ye(t)).map(([t,n])=>[ln(t),n]).filter(([t,n])=>!rn(t))}const et=({el:e})=>e,gn=(e,t)=>e.__draggable_context=t,tt=e=>e.__draggable_context;class pn{constructor({nodes:{header:t,default:n,footer:o},root:s,realList:l}){this.defaultNodes=n,this.children=[...t,...n,...o],this.externalComponent=s.externalComponent,this.rootTransition=s.transition,this.tag=s.tag,this.realList=l}get _isRootComponent(){return this.externalComponent||this.rootTransition}render(t,n){const{tag:o,children:s,_isRootComponent:l}=this;return t(o,n,l?{default:()=>s}:s)}updated(){const{defaultNodes:t,realList:n}=this;t.forEach((o,s)=>{gn(et(o),{element:n[s],index:s})})}getUnderlyingVm(t){return tt(t)}getVmIndexFromDomIndex(t,n){const{defaultNodes:o}=this,{length:s}=o,l=n.children,a=l.item(t);if(a===null)return s;const c=tt(a);if(c)return c.index;if(s===0)return 0;const i=et(o[0]),r=[...l].findIndex(b=>b===i);return t<r?0:s}}function hn(e,t){const n=e[t];return n?n():[]}function _n({$slots:e,realList:t,getKey:n}){const o=t||[],[s,l]=["header","footer"].map(i=>hn(e,i)),{item:a}=e;if(!a)throw new Error("draggable element must have an item slot");const c=o.flatMap((i,r)=>a({element:i,index:r}).map(b=>(b.key=n(i),b.props=A(C({},b.props||{}),{"data-draggable":!0}),b)));if(c.length!==o.length)throw new Error("Item slot must have only one child");return{header:s,footer:l,default:c}}function bn(e){const t=dn(e),n=!un(e)&&!t;return{transition:t,externalComponent:n,tag:n?T(e):t?_t:e}}function Cn({$slots:e,tag:t,realList:n,getKey:o}){const s=_n({$slots:e,realList:n,getKey:o}),l=bn(t);return new pn({nodes:s,root:l,realList:n})}function nt(e,t){me(()=>this.$emit(e.toLowerCase(),t))}function ot(e){return(t,n)=>{if(this.realList!==null)return this[`onDrag${e}`](t,n)}}function yn(e){const t=ot.call(this,e);return(n,o)=>{t.call(this,n,o),nt.call(this,e,n)}}let $e=null;const vn={list:{type:Array,required:!1,default:null},modelValue:{type:Array,required:!1,default:null},itemKey:{type:[String,Function],required:!0},clone:{type:Function,default:e=>e},tag:{type:String,default:"div"},move:{type:Function,default:null},componentData:{type:Object,required:!1,default:null}},kn=["update:modelValue","change",...[...Ee.manageAndEmit,...Ee.emit].map(e=>e.toLowerCase())],Sn=ie({name:"draggable",inheritAttrs:!1,props:vn,emits:kn,data(){return{error:!1}},render(){try{this.error=!1;const{$slots:e,$attrs:t,tag:n,componentData:o,realList:s,getKey:l}=this,a=Cn({$slots:e,tag:n,realList:s,getKey:l});this.componentStructure=a;const c=mn({$attrs:t,componentData:o});return a.render(U,c)}catch(e){return this.error=!0,U("pre",{style:{color:"red"}},e.stack)}},created(){this.list!==null&&this.modelValue!==null&&nn.error("modelValue and list props are mutually exclusive! Please set one or another.")},mounted(){if(this.error)return;const{$attrs:e,$el:t,componentStructure:n}=this;n.updated();const o=fn({$attrs:e,callBackBuilder:{manageAndEmit:l=>yn.call(this,l),emit:l=>nt.bind(this,l),manage:l=>ot.call(this,l)}}),s=t.nodeType===1?t:t.parentElement;this._sortable=new Wt(s,o),this.targetDomElement=s,s.__draggable_component__=this},updated(){this.componentStructure.updated()},beforeUnmount(){this._sortable!==void 0&&this._sortable.destroy()},computed:{realList(){const{list:e}=this;return e||this.modelValue},getKey(){const{itemKey:e}=this;return typeof e=="function"?e:t=>t[e]}},watch:{$attrs:{handler(e){const{_sortable:t}=this;!t||Je(e).forEach(([n,o])=>{t.option(n,o)})},deep:!0}},methods:{getUnderlyingVm(e){return this.componentStructure.getUnderlyingVm(e)||null},getUnderlyingPotencialDraggableComponent(e){return e.__draggable_component__},emitChanges(e){me(()=>this.$emit("change",e))},alterList(e){if(this.list){e(this.list);return}const t=[...this.modelValue];e(t),this.$emit("update:modelValue",t)},spliceList(){const e=t=>t.splice(...arguments);this.alterList(e)},updatePosition(e,t){const n=o=>o.splice(t,0,o.splice(e,1)[0]);this.alterList(n)},getRelatedContextFromMoveEvent({to:e,related:t}){const n=this.getUnderlyingPotencialDraggableComponent(e);if(!n)return{component:n};const o=n.realList,s={list:o,component:n};if(e!==t&&o){const l=n.getUnderlyingVm(t)||{};return C(C({},l),s)}return s},getVmIndexFromDomIndex(e){return this.componentStructure.getVmIndexFromDomIndex(e,this.targetDomElement)},onDragStart(e){this.context=this.getUnderlyingVm(e.item),e.item._underlying_vm_=this.clone(this.context.element),$e=e.item},onDragAdd(e){const t=e.item._underlying_vm_;if(t===void 0)return;we(e.item);const n=this.getVmIndexFromDomIndex(e.newIndex);this.spliceList(n,0,t);const o={element:t,newIndex:n};this.emitChanges({added:o})},onDragRemove(e){if(We(this.$el,e.item,e.oldIndex),e.pullMode==="clone"){we(e.clone);return}const{index:t,element:n}=this.context;this.spliceList(t,1);const o={element:n,oldIndex:t};this.emitChanges({removed:o})},onDragUpdate(e){we(e.item),We(e.from,e.item,e.oldIndex);const t=this.context.index,n=this.getVmIndexFromDomIndex(e.newIndex);this.updatePosition(t,n);const o={element:this.context.element,oldIndex:t,newIndex:n};this.emitChanges({moved:o})},computeFutureIndex(e,t){if(!e.element)return 0;const n=[...t.to.children].filter(a=>a.style.display!=="none"),o=n.indexOf(t.related),s=e.component.getVmIndexFromDomIndex(o);return n.indexOf($e)!==-1||!t.willInsertAfter?s:s+1},onDragMove(e,t){const{move:n,realList:o}=this;if(!n||!o)return!0;const s=this.getRelatedContextFromMoveEvent(e),l=this.computeFutureIndex(s,e),a=A(C({},this.context),{futureIndex:l}),c=A(C({},e),{relatedContext:s,draggedContext:a});return n(c,t)},onDragEnd(){$e=null}}});const wn=ie({name:"ColumnSetting",components:{SettingOutlined:bt,DragOutlined:Ct,Draggable:Sn,VerticalRightOutlined:yt,VerticalLeftOutlined:vt},setup(){const{getDarkTheme:e}=Gt(),t=Ke(),n=I([]),o=I([]),s=Fe({selection:!1,checkAll:!0,checkList:[],defaultCheckList:[]}),l=E(()=>s.selection);fe(()=>{t.getColumns().length&&a()});function a(){const u=r(),p=u.map($=>$.key);s.checkList=p,s.defaultCheckList=p;const k=u.filter($=>$.key!="action"&&$.title!="\u64CD\u4F5C");n.value.length||(n.value=le(k),o.value=le(k))}function c(u){s.selection&&u.unshift("selection"),i(u)}function i(u){t.setColumns(u)}function r(){let u=[];return t.getColumns().forEach(p=>{u.push(C({},p))}),u}function b(){s.checkList=[...s.defaultCheckList],s.checkAll=!0;let p=t.getCacheColumns().map(k=>A(C({},k),{fixed:void 0}));i(p),n.value=p}function D(u){let p=t.getCacheColumns(!0);u?(i(p),s.checkList=p):(i([]),s.checkList=[])}function F(){const u=X(d(n));n.value=u,i(u)}function f(u){let p=t.getCacheColumns();u?(p.unshift({type:"selection",key:"selection"}),i(p)):(p.splice(0,1),i(p))}function g(u,p){if(!s.checkList.includes(u.key))return;let k=r();const $=u.fixed===p?void 0:p;let w=k.findIndex(R=>R.key===u.key);w!==-1&&(k[w].fixed=$),t.setCacheColumnsField(u.key,{fixed:$}),n.value[w].fixed=$,i(k)}return A(C({},Le(s)),{columnsList:n,getDarkTheme:e,onChange:c,onCheckAll:D,onSelection:f,resetColumns:b,fixedColumn:g,draggableEnd:F,getSelection:l})}}),En={class:"cursor-pointer table-toolbar-right-icon"},$n={class:"table-toolbar-inner-popover-title"},On=Y("\u5217\u5C55\u793A"),Dn=Y("\u52FE\u9009\u5217"),xn=Y("\u91CD\u7F6E"),Fn={class:"table-toolbar-inner"},Ln={class:"drag-icon"},Pn={class:"fixed-item"},In=x("span",null,"\u56FA\u5B9A\u5230\u5DE6\u4FA7",-1),Rn=x("span",null,"\u56FA\u5B9A\u5230\u53F3\u4FA7",-1),An=x("span",null,"\u5217\u8BBE\u7F6E",-1);function Vn(e,t,n,o,s,l){const a=T("SettingOutlined"),c=ae,i=Pe,r=Ie,b=St,D=T("DragOutlined"),F=T("VerticalRightOutlined"),f=Ce,g=wt,u=T("VerticalLeftOutlined"),p=T("Draggable"),k=Et,$=Re;return N(),ee(f,{trigger:"hover"},{trigger:_(()=>[x("div",En,[h($,{trigger:"click",width:230,class:"toolbar-popover",placement:"bottom-end"},{trigger:_(()=>[h(c,{size:"18"},{default:_(()=>[h(a)]),_:1})]),header:_(()=>[x("div",$n,[h(b,null,{default:_(()=>[h(i,{checked:e.checkAll,"onUpdate:checked":[t[0]||(t[0]=w=>e.checkAll=w),e.onCheckAll]},{default:_(()=>[On]),_:1},8,["checked","onUpdate:checked"]),h(i,{checked:e.selection,"onUpdate:checked":[t[1]||(t[1]=w=>e.selection=w),e.onSelection]},{default:_(()=>[Dn]),_:1},8,["checked","onUpdate:checked"]),h(r,{text:"",type:"info",size:"small",class:"mt-1",onClick:e.resetColumns},{default:_(()=>[xn]),_:1},8,["onClick"])]),_:1})])]),default:_(()=>[x("div",Fn,[h(k,{value:e.checkList,"onUpdate:value":[t[3]||(t[3]=w=>e.checkList=w),e.onChange]},{default:_(()=>[h(p,{modelValue:e.columnsList,"onUpdate:modelValue":t[2]||(t[2]=w=>e.columnsList=w),animation:"300","item-key":"key",onEnd:e.draggableEnd},{item:_(({element:w})=>[x("div",{class:kt(["table-toolbar-inner-checkbox",{"table-toolbar-inner-checkbox-dark":e.getDarkTheme===!0}])},[x("span",Ln,[h(c,{size:"18"},{default:_(()=>[h(D)]),_:1})]),h(i,{value:w.key,label:w.title},null,8,["value","label"]),x("div",Pn,[h(f,{trigger:"hover",placement:"bottom"},{trigger:_(()=>[h(c,{size:"18",color:w.fixed==="left"?"#2080f0":void 0,class:"cursor-pointer",onClick:R=>e.fixedColumn(w,"left")},{default:_(()=>[h(F)]),_:2},1032,["color","onClick"])]),default:_(()=>[In]),_:2},1024),h(g,{vertical:""}),h(f,{trigger:"hover",placement:"bottom"},{trigger:_(()=>[h(c,{size:"18",color:w.fixed==="right"?"#2080f0":void 0,class:"cursor-pointer",onClick:R=>e.fixedColumn(w,"right")},{default:_(()=>[h(u)]),_:2},1032,["color","onClick"])]),default:_(()=>[Rn]),_:2},1024)])],2)]),_:1},8,["modelValue","onEnd"])]),_:1},8,["value","onUpdate:value"])])]),_:1})])]),default:_(()=>[An]),_:1})}var st=_e(wn,[["render",Vn]]);function zn(e){const t=I(d(e).loading);ye(()=>d(e).loading,s=>{t.value=s});const n=E(()=>d(t));function o(s){t.value=s}return{getLoading:n,setLoading:o}}var Oe;(function(e){e.NInput="on-input",e.NInputNumber="on-input",e.NSelect="on-update:value",e.NSwitch="on-update:value",e.NCheckbox="on-update:value",e.NDatePicker="on-update:value",e.NTimePicker="on-update:value"})(Oe||(Oe={}));const W=new Map;W.set("NInput",$t);W.set("NInputNumber",Ot);W.set("NSelect",Dt);W.set("NSwitch",xt);W.set("NCheckbox",Pe);W.set("NDatePicker",Ft);W.set("NTimePicker",Lt);const Tn=({component:e="NInput",rule:t=!0,ruleMessage:n,popoverVisible:o},{attrs:s})=>{const l=W.get(e),a=U(l,s);return t?U(Re,{"display-directive":"show",show:!!o,manual:"manual"},{trigger:()=>a,default:()=>U("span",{style:{color:"red",width:"90px",display:"inline-block"}},{default:()=>n})}):a};function Nn(e){return!e||!e.getBoundingClientRect?0:e.getBoundingClientRect()}function Bn(e){const t=document.documentElement,n=t.scrollLeft,o=t.scrollTop,s=t.clientLeft,l=t.clientTop,a=window.pageXOffset,c=window.pageYOffset,i=Nn(e),{left:r,top:b,width:D,height:F}=i,f=(a||n)-(s||0),g=(c||o)-(l||0),u=r+a,p=b+c,k=u-f,$=p-g,w=window.document.documentElement.clientWidth,R=window.document.documentElement.clientHeight;return{left:k,top:$,right:w-D-k,bottom:R-F-$,rightIncludeBody:w-k,bottomIncludeBody:R-$}}function it(e,t,n){e&&t&&n&&e.addEventListener(t,n,!1)}const be=new Map;let lt;Qt||(it(document,"mousedown",e=>lt=e),it(document,"mouseup",e=>{for(const{documentHandler:t}of be.values())t(e,lt)}));function at(e,t){let n=[];return Array.isArray(t.arg)?n=t.arg:n.push(t.arg),function(o,s){const l=t.instance.popperRef,a=o.target,c=s.target,i=!t||!t.instance,r=!a||!c,b=e.contains(a)||e.contains(c),D=e===a,F=n.length&&n.some(g=>g==null?void 0:g.contains(a))||n.length&&n.includes(c),f=l&&(l.contains(a)||l.contains(c));i||r||b||D||F||f||t.value()}}const Hn={beforeMount(e,t){be.set(e,{documentHandler:at(e,t),bindingFn:t.value})},updated(e,t){be.set(e,{documentHandler:at(e,t),bindingFn:t.value})},unmounted(e){be.delete(e)}};function rt(e){return e==="NInput"?"\u8BF7\u8F93\u5165":["NPicker","NSelect","NCheckbox","NRadio","NSwitch","NDatePicker","NTimePicker"].includes(e)?"\u8BF7\u9009\u62E9":""}const Un=ie({name:"EditableCell",components:{FormOutlined:Ae,CloseOutlined:Pt,CheckOutlined:It,CellComponent:Tn},directives:{clickOutside:Hn},props:{value:{type:[String,Number,Boolean,Object],default:""},record:{type:Object},column:{type:Object,default:()=>({})},index:Se.number},setup(e){const t=Ke(),n=I(!1),o=I(),s=I(!1),l=I(""),a=I([]),c=I(e.value),i=I(e.value),r=E(()=>{var m;return((m=e.column)==null?void 0:m.editComponent)||"NInput"}),b=E(()=>{var m;return(m=e.column)==null?void 0:m.editRule}),D=E(()=>d(l)&&d(s)),F=E(()=>{const m=d(r);return["NCheckbox","NRadio"].includes(m)}),f=E(()=>{var oe,J,de,Q;const m=(J=(oe=e.column)==null?void 0:oe.editComponentProps)!=null?J:{},y=(Q=(de=e.column)==null?void 0:de.editComponent)!=null?Q:null,v=d(r),P={},O=d(F),S=O?"checked":"value",L=d(c);let V=O?ve(L)&&B(L)?L:!!L:L;ke(V)&&v==="NDatePicker"?V=Ve(V):re(V)&&v==="NDatePicker"&&(V=V.map(se=>Ve(se)));const z=y?Oe[y]:void 0;return A(C(C({placeholder:rt(d(r))},P),Rt(m,"onChange")),{[z]:w,[S]:V})}),g=E(()=>{var L,V;const{editComponentProps:m,editValueMap:y}=e.column,v=d(c);if(y&&ce(y))return y(v);if(!d(r).includes("NSelect"))return v;const S=((L=m==null?void 0:m.options)!=null?L:d(a)||[]).find(z=>`${z.value}`==`${v}`);return(V=S==null?void 0:S.label)!=null?V:v}),u=E(()=>({width:"calc(100% - 48px)"})),p=E(()=>{const{align:m="center"}=e.column;return`edit-cell-align-${m}`}),k=E(()=>{const{editable:m}=e.record||{};return!!m});fe(()=>{i.value=e.value}),fe(()=>{const{editable:m}=e.column;(B(m)||B(d(k)))&&(n.value=!!m||d(k))});function $(){var m;d(k)||d((m=e.column)==null?void 0:m.editRow)||(l.value="",n.value=!0,me(()=>{var v;const y=d(o);(v=y==null?void 0:y.focus)==null||v.call(y)}))}function w(y){return H(this,arguments,function*(m){var O,S,L;const v=d(r);m?(m==null?void 0:m.target)&&Reflect.has(m.target,"value")?c.value=m.target.value:v==="NCheckbox"?c.value=m.target.checked:(ke(m)||B(m)||ve(m))&&(c.value=m):c.value=m;const P=(S=(O=e.column)==null?void 0:O.editComponentProps)==null?void 0:S.onChange;P&&ce(P)&&P(...arguments),(L=t.emit)==null||L.call(t,"edit-change",{column:e.column,value:d(c),record:X(e.record)}),yield R()})}function R(){return H(this,null,function*(){const{column:m,record:y}=e,{editRule:v}=m,P=d(c);if(v){if(B(v)&&!P&&!ve(P)){s.value=!0;const O=d(r);return l.value=rt(O),!1}if(ce(v)){const O=yield v(P,y);return O?(l.value=O,s.value=!0,!1):(l.value="",!0)}}return l.value="",!0})}function j(m=!0,y=!0){return H(this,null,function*(){var z;if(y&&!(yield R()))return!1;const{column:v,index:P,record:O}=e;if(!O)return!1;const{key:S}=v,L=d(c);if(!S)return;At(O,S,L),m&&((z=t.emit)==null||z.call(t,"edit-end",{record:O,index:P,key:S,value:L})),n.value=!1})}function ne(){return H(this,null,function*(){var m;((m=e.column)==null?void 0:m.editRow)||(yield j())})}function G(){var O;n.value=!1,c.value=i.value;const{column:m,index:y,record:v}=e,{key:P}=m;s.value=!0,l.value="",(O=t.emit)==null||O.call(t,"edit-cancel",{record:v,index:y,key:P,value:d(c)})}function q(){var y;if(((y=e.column)==null?void 0:y.editable)||d(k))return;d(r).includes("NInput")&&G()}function M(m){a.value=m}function K(m,y){var v;e.record&&(re(e.record[m])?(v=e.record[m])==null||v.push(y):e.record[m]=[y])}return e.record&&(K("submitCbs",j),K("validCbs",R),K("cancelCbs",G),e.column.key&&(e.record.editValueRefs||(e.record.editValueRefs={}),e.record.editValueRefs[e.column.key]=c),e.record.onCancelEdit=()=>{var m,y;re((m=e.record)==null?void 0:m.cancelCbs)&&((y=e.record)==null||y.cancelCbs.forEach(v=>v()))},e.record.onSubmitEdit=()=>H(this,null,function*(){var m,y,v,P;if(re((m=e.record)==null?void 0:m.submitCbs)){const O=(((y=e.record)==null?void 0:y.validCbs)||[]).map(z=>z());return(yield Promise.all(O)).every(z=>!!z)?((((v=e.record)==null?void 0:v.submitCbs)||[]).forEach(z=>z(!1,!1)),(P=t.emit)==null||P.call(t,"edit-row-end"),!0):void 0}})),{isEdit:n,handleEdit:$,currentValueRef:c,handleSubmit:j,handleChange:w,handleCancel:G,elRef:o,getComponent:r,getRule:b,onClickOutside:q,ruleMessage:l,getRuleVisible:D,getComponentProps:f,handleOptionsChange:M,getWrapperStyle:u,getWrapperClass:p,getRowEditable:k,getValues:g,handleEnter:ne}}}),jn={class:"editable-cell"},Mn={class:"flex editable-cell-content"},qn={class:"editable-cell-content-comp"},Kn={key:0,class:"editable-cell-action"};function Wn(e,t,n,o,s,l){const a=T("FormOutlined"),c=ae,i=T("CellComponent"),r=T("CheckOutlined"),b=T("CloseOutlined"),D=Vt("click-outside");return N(),Z("div",jn,[ze(x("div",{class:"editable-cell-content",onClick:t[0]||(t[0]=(...F)=>e.handleEdit&&e.handleEdit(...F))},[Y(ge(e.getValues)+" ",1),e.column.editRow?te("",!0):(N(),ee(c,{key:0,class:"edit-icon"},{default:_(()=>[h(a)]),_:1}))],512),[[Te,!e.isEdit]]),ze((N(),Z("div",Mn,[x("div",qn,[h(i,pe(e.getComponentProps,{component:e.getComponent,style:e.getWrapperStyle,popoverVisible:e.getRuleVisible,ruleMessage:e.ruleMessage,rule:e.getRule,class:e.getWrapperClass,ref:"elRef",onOptionsChange:e.handleOptionsChange,onPressEnter:e.handleEnter}),null,16,["component","style","popoverVisible","ruleMessage","rule","class","onOptionsChange","onPressEnter"])]),e.getRowEditable?te("",!0):(N(),Z("div",Kn,[h(c,{class:"mx-2 cursor-pointer"},{default:_(()=>[h(r,{onClick:e.handleSubmit},null,8,["onClick"])]),_:1}),h(c,{class:"mx-2 cursor-pointer"},{default:_(()=>[h(b,{onClick:e.handleCancel},null,8,["onClick"])]),_:1})]))])),[[Te,e.isEdit],[D,e.onClickOutside]])])}var Gn=_e(Un,[["render",Wn]]);function Qn(e){return(t,n)=>{const o=e.key,s=t[o];return t.onEdit=(l,a=!1)=>H(this,null,function*(){var c,i;return a||(t.editable=l),!l&&a?(yield(c=t.onSubmitEdit)==null?void 0:c.call(t))?(t.editable=!1,!0):!1:(!l&&!a&&((i=t.onCancelEdit)==null||i.call(t)),!0)}),U(Gn,{value:s,record:t,column:e,index:n})}}function Xn(e){const t=I(d(e).columns);let n=d(e).columns;const o=E(()=>{const f=le(d(t));return i(e,f),f||[]}),{hasPermission:s}=Me();function l(f){const g=f.ifShow;let u=!0;return B(g)&&(u=g),ce(g)&&(u=g(f)),u}const a=(f,g)=>U(Ce,null,{trigger:()=>f,default:()=>g}),c=E(()=>{const f=d(o);return le(f).filter(u=>s(u.auth)&&l(u)).map(u=>{u.ellipsis=typeof u.ellipsis=="undefined"?{tooltip:!0}:!1;const{edit:p}=u;if(p&&(u.render=Qn(u),p)){const k=u.title;u.title=()=>a(U("span",{},[U("span",{style:{"margin-right":"5px"}},k),U(ae,{size:14},{default:()=>U(Ae)})]),"\u8BE5\u5217\u53EF\u7F16\u8F91")}return u})});ye(()=>d(e).columns,f=>{t.value=f,n=f});function i(f,g){const{actionColumn:u}=d(f);!u||!g.find(p=>p.key==="action")&&g.push(C({},u))}function r(f){const g=le(f);if(!re(g))return;if(!g.length){t.value=[];return}const u=n.map(p=>p.key);if(!ke(g[0]))t.value=g;else{const p=[];n.forEach(k=>{f.includes(k.key)&&p.push(C({},k))}),zt(u,g)||p.sort((k,$)=>u.indexOf(k.key)-u.indexOf($.key)),t.value=p}}function b(){return X(d(o)).map(g=>A(C({},g),{title:g.title,key:g.key,fixed:g.fixed||void 0}))}function D(f){return f?n.map(g=>g.key):n}function F(f,g){!f||!g||n.forEach(u=>{if(u.key===f){Object.assign(u,g);return}})}return{getColumnsRef:o,getCacheColumns:D,setCacheColumnsField:F,setColumns:r,getColumns:b,getPageColumns:c}}const{table:Yn}=Xt,{apiSetting:Zn,defaultPageSize:Jn,pageSizes:eo}=Yn,to=Jn,ue=Zn,no=eo;function oo(e,{getPaginationInfo:t,setPagination:n,setLoading:o,tableData:s},l){const a=I([]);fe(()=>{s.value=d(a)}),ye(()=>d(e).dataSource,()=>{const{dataSource:f}=d(e);f&&(a.value=f)},{immediate:!0});const c=E(()=>{const{rowKey:f}=d(e);return f||(()=>"key")}),i=E(()=>{const f=d(a);return!f||f.length===0?d(a):d(a)});function r(f){return H(this,null,function*(){try{o(!0);const{request:g,pagination:u}=d(e),p=ue.pageField,k=ue.sizeField,$=ue.totalField,w=ue.listField;let R={};const{page:j=1,pageSize:ne=10}=d(t);B(u)&&!u||B(t)?R={}:(R[p]=f&&f[p]||j,R[k]=ne);const G=C({},R),q=yield g(G),M=q[$]||0,K=q[p];M&&j>M&&(n({[p]:M}),r(f));const m=q[w]?q[w]:[];a.value=m,n({[p]:K,[$]:M}),f&&f[p]&&n({[p]:f[p]||1}),l("fetch-success",{items:d(m),resultTotal:M})}catch(g){console.error(g),l("fetch-error",g),a.value=[]}finally{o(!1)}})}Ne(()=>{setTimeout(()=>{r()},16)});function b(f){a.value=f}function D(){return i.value}function F(f){return H(this,null,function*(){yield r(f)})}return{fetch:r,getRowKey:c,getDataSourceRef:i,getDataSource:D,setTableData:b,reload:F}}function so(e){const t=I({}),n=I(!0),o=E(()=>{const{pagination:i}=d(e);if(!d(n)||B(i)&&!i)return!1;const{totalField:r}=ue;return A(C(C({pageSize:to,pageSizes:no,showSizePicker:!0,showQuickJumper:!0},B(i)?{}:i),d(t)),{pageCount:d(t)[r]})});function s(i){const r=d(o);t.value=C(C({},B(r)?{}:r),i)}function l(){return d(o)}function a(){return d(n)}function c(i){return H(this,null,function*(){n.value=i})}return{getPagination:l,getPaginationInfo:o,setShowPagination:c,getShowPagination:a,setPagination:s}}const io=A(C({},Be.props),{title:{type:String,default:null},titleTooltip:{type:String,default:null},size:{type:String,default:"medium"},tableData:{type:[Object],default:()=>[]},columns:{type:[Array],default:()=>[],required:!0},request:{type:Function,default:null,required:!0},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},showPagination:{type:[String,Boolean],default:"auto"},actionColumn:{type:Object,default:null},canResize:Se.bool.def(!0),resizeHeightOffset:Se.number.def(0)});function lo(e,t=150,n){let o=()=>{e()};o=Jt(o,t);const l=()=>{n&&n.immediate&&o(),window.addEventListener("resize",o)},a=()=>{window.removeEventListener("resize",o)};return Yt(()=>{l()}),Zt(()=>{a()}),[l,a]}const ao=[{type:"menu",label:"\u7D27\u51D1",key:"small"},{type:"menu",label:"\u9ED8\u8BA4",key:"medium"},{type:"menu",label:"\u5BBD\u677E",key:"large"}],ro=ie({components:{ReloadOutlined:Tt,ColumnHeightOutlined:Nt,ColumnSetting:st,QuestionCircleOutlined:Bt},props:C({},io),emits:["fetch-success","fetch-error","update:checked-row-keys","edit-end","edit-cancel","edit-row-end","edit-change"],setup(e,{emit:t}){const n=I(150),o=I(null),s=I(null);let l;const a=I([]),c=I(),i=E(()=>C(C({},e),d(c))),{getLoading:r,setLoading:b}=zn(i),{getPaginationInfo:D,setPagination:F}=so(i),{getDataSourceRef:f,getRowKey:g,reload:u}=oo(i,{getPaginationInfo:D,setPagination:F,tableData:a,setLoading:b},t),{getPageColumns:p,setColumns:k,getColumns:$,getCacheColumns:w,setCacheColumnsField:R}=Xn(i),j=Fe({tableSize:d(i).size||"medium",isColumnSetting:!1});function ne(S){F({page:S}),u()}function G(S){F({page:1,pageSize:S}),u()}function q(S){j.tableSize=S}const M=E(()=>j.tableSize),K=E(()=>{const S=d(f),L=S.length?`${d(n)}px`:"auto";return A(C({},d(i)),{loading:d(r),columns:X(d(p)),rowKey:d(g),data:S,size:d(M),remote:!0,"max-height":L})}),m=E(()=>X(d(D)));function y(S){c.value=C(C({},d(c)),S)}const v={reload:u,setColumns:k,setLoading:b,setProps:y,getColumns:$,getPageColumns:p,getCacheColumns:w,setCacheColumnsField:R,emit:t},P=E(()=>{const{canResize:S}=d(i);return S});function O(){return H(this,null,function*(){const S=d(o);if(!S||!d(P))return;const L=S==null?void 0:S.$el,V=L.querySelector(".n-data-table-thead "),{bottomIncludeBody:z}=Bn(V),oe=64;let J=2,de=24;B(m)||(l=L.querySelector(".n-data-table__pagination"),l?J+=l.offsetHeight||0:J+=28);let Q=z-(oe+J+de+(e.resizeHeightOffset||0));const se=e.maxHeight;Q=se&&se<Q?se:Q,n.value=Q})}return lo(O,280),Ne(()=>{me(()=>{O()})}),en(A(C({},v),{wrapRef:s,getBindValues:K})),A(C({},Le(j)),{tableElRef:o,getBindValues:K,densityOptions:ao,reload:u,densitySelect:q,updatePage:ne,updatePageSize:G,pagination:m,tableAction:v})}}),ct=e=>(Mt("data-v-1b1df032"),e=e(),qt(),e),co={class:"table-toolbar"},uo={class:"flex items-center table-toolbar-left"},mo={key:0,class:"table-toolbar-left-title"},fo={class:"flex items-center table-toolbar-right"},go=ct(()=>x("span",null,"\u5237\u65B0",-1)),po={class:"table-toolbar-right-icon"},ho=ct(()=>x("span",null,"\u5BC6\u5EA6",-1)),_o={class:"s-table"};function bo(e,t,n,o,s,l){const a=T("QuestionCircleOutlined"),c=ae,i=Ce,r=T("ReloadOutlined"),b=T("ColumnHeightOutlined"),D=je,F=st,f=Be;return N(),Z(Ue,null,[x("div",co,[x("div",uo,[e.title?(N(),Z("div",mo,[Y(ge(e.title)+" ",1),e.titleTooltip?(N(),ee(i,{key:0,trigger:"hover"},{trigger:_(()=>[h(c,{size:"18",class:"ml-1 cursor-pointer text-gray-400"},{default:_(()=>[h(a)]),_:1})]),default:_(()=>[Y(" "+ge(e.titleTooltip),1)]),_:1})):te("",!0)])):te("",!0),he(e.$slots,"tableTitle",{},void 0,!0)]),x("div",fo,[he(e.$slots,"toolbar",{},void 0,!0),h(i,{trigger:"hover"},{trigger:_(()=>[x("div",{class:"table-toolbar-right-icon",onClick:t[0]||(t[0]=(...g)=>e.reload&&e.reload(...g))},[h(c,{size:"18"},{default:_(()=>[h(r)]),_:1})])]),default:_(()=>[go]),_:1}),h(i,{trigger:"hover"},{trigger:_(()=>[x("div",po,[h(D,{onSelect:e.densitySelect,trigger:"click",options:e.densityOptions,value:e.tableSize,"onUpdate:value":t[1]||(t[1]=g=>e.tableSize=g)},{default:_(()=>[h(c,{size:"18"},{default:_(()=>[h(b)]),_:1})]),_:1},8,["onSelect","options","value"])])]),default:_(()=>[ho]),_:1}),h(F)])]),x("div",_o,[h(f,pe({ref:"tableElRef"},e.getBindValues,{pagination:e.pagination,"onUpdate:page":e.updatePage,"onUpdate:pageSize":e.updatePageSize}),Ht({_:2},[He(Object.keys(e.$slots),g=>({name:g,fn:_(u=>[he(e.$slots,g,Ut(jt(u)),void 0,!0)])}))]),1040,["pagination","onUpdate:page","onUpdate:pageSize"])])],64)}var Ro=_e(ro,[["render",bo],["__scopeId","data-v-1b1df032"]]);const Co=ie({name:"TableAction",components:{DownOutlined:Kt},props:{actions:{type:Array,default:null,required:!0},dropDownActions:{type:Array,default:null},style:{type:String,default:"button"},select:{type:Function,default:()=>{}}},setup(e){const{hasPermission:t}=Me(),n=e.style==="button"?"default":e.style==="text"?"primary":"default",o=e.style==="button"?void 0:e.style==="text"?!0:void 0,s=E(()=>({text:o,type:n,size:"small"})),l=E(()=>(X(e.dropDownActions)||[]).filter(i=>t(i.auth)&&a(i)).map(i=>{const{popConfirm:r}=i;return A(C(C({size:"small",text:o,type:n},i),r),{onConfirm:r==null?void 0:r.confirm,onCancel:r==null?void 0:r.cancel})}));function a(i){const r=i.ifShow;let b=!0;return B(r)&&(b=r),ce(r)&&(b=r(i)),b}return{getActions:E(()=>(X(e.actions)||[]).filter(i=>t(i.auth)&&a(i)).map(i=>{const{popConfirm:r}=i;return A(C(C({size:"small",text:o,type:n},i),r||{}),{onConfirm:r==null?void 0:r.confirm,onCancel:r==null?void 0:r.cancel,enable:!!r})})),getDropdownList:l,getMoreProps:s}}}),yo={class:"tableAction"},vo={class:"flex items-center justify-center"},ko={class:"flex items-center"},So=x("span",null,"\u66F4\u591A",-1);function wo(e,t,n,o,s,l){const a=Ie,c=T("DownOutlined"),i=ae,r=je;return N(),Z("div",yo,[x("div",vo,[(N(!0),Z(Ue,null,He(e.getActions,(b,D)=>(N(),ee(a,pe({key:`${D}-${b.label}`},b,{class:"mx-2"}),{default:_(()=>[Y(ge(b.label),1)]),_:2},1040))),128)),e.dropDownActions&&e.getDropdownList.length?(N(),ee(r,{key:0,trigger:"hover",options:e.getDropdownList,onSelect:e.select},{default:_(()=>[he(e.$slots,"more"),e.$slots.more?te("",!0):(N(),ee(a,pe({key:0},e.getMoreProps,{class:"mx-2","icon-placement":"right"}),{default:_(()=>[x("div",ko,[So,h(i,{size:"14",class:"ml-1"},{default:_(()=>[h(c)]),_:1})])]),_:1},16))]),_:3},8,["options","onSelect"])):te("",!0)])])}var Ao=_e(Co,[["render",wo]]);export{Ro as B,Ao as T};
